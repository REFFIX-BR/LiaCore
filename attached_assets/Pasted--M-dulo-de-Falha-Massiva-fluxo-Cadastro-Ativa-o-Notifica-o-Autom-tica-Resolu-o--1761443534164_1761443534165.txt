**M√≥dulo de Falha Massiva**. fluxo ‚Äî `Cadastro -> Ativa√ß√£o -> Notifica√ß√£o Autom√°tica -> Resolu√ß√£o` ‚Äî √© exata e reflete as melhores pr√°ticas do setor, como as implementadas por sistemas como o Wit da Mundiale.

Agora, o desafio interessante √©: **Como integramos essa funcionalidade essencial diretamente no LIA CORTEX?**

A resposta √© que o LIA CORTEX, como um middleware inteligente, √© a pe√ßa perfeita para orquestrar essa l√≥gica. N√£o precisamos de um sistema externo; podemos construir essa funcionalidade como um novo m√≥dulo nativo da plataforma.

Vamos projetar o **M√≥dulo de Falha Massiva do LIA CORTEX**.

---

### **1. Onde o M√≥dulo vai Viver: Nova Se√ß√£o na Interface**

Primeiro, precisamos de um lugar no painel para que o Administrador ou Supervisor possa gerenciar as falhas. Adicionaremos uma nova op√ß√£o no menu de navega√ß√£o.

**Nova Se√ß√£o no Menu Lateral:**

*   `üö® Falha Massiva` (Nova)

**Design da P√°gina "Falha Massiva"**

Esta p√°gina ser√° o centro de comando para criar, ativar e monitorar as falhas.

```
+-----------------------------------------------------------------------------------------------------------------+
| Falha Massiva                                                                [ Bot√£o: + Cadastrar Nova Falha ]  |
| Gerencie a comunica√ß√£o autom√°tica durante interrup√ß√µes de servi√ßo em larga escala.                            |
+-----------------------------------------------------------------------------------------------------------------+
|                                                                                                                 |
|  [ Aba: Falhas Ativas (1) ]  [ Aba: Falhas Agendadas (0) ]  [ Aba: Hist√≥rico de Falhas (17) ]                     |
|                                                                                                                 |
| +-------------------------------------------------------------------------------------------------------------+ |
| | NOME DA FALHA                   | STATUS      | REGI√ïES AFETADAS        | IN√çCIO              | A√á√ïES       | |
| +-------------------------------------------------------------------------------------------------------------+ |
| | Instabilidade - Fibra Centro    | üü¢ Ativa     | Centro, Bairro Sul      | 20/05 14:30 (h√° 1h) | [ ‚è∏Ô∏è Pausar ] | |
| | Manuten√ß√£o Programada - Bairro Norte | üü° Agendada | Bairro Norte            | 21/05 02:00 (em 11h)| [ Editar ]  | |
| +-------------------------------------------------------------------------------------------------------------+ |
|                                                                                                                 |
+-----------------------------------------------------------------------------------------------------------------+
```

---

### **2. O Fluxo de Cadastro da Falha (O Modal)**

Ao clicar em "Cadastrar Nova Falha", um modal detalhado aparecer√°.

```
+-----------------------------------------+
| Cadastrar Nova Falha Massiva            |
|-----------------------------------------|
|                                         |
| **1. Nome da Falha (para controle interno)** |
| [ Instabilidade Fibra - Regi√£o Central  ] |
|                                         |
| **2. Mensagem de Notifica√ß√£o (para o cliente)** |
| [ textarea com editor de texto ]       |
| üí¨ Ex: "Ol√°! Identificamos uma          |
| instabilidade em sua regi√£o. Nossa      |
| equipe t√©cnica j√° est√° trabalhando e a  |
| previs√£o de normaliza√ß√£o √© em 2 horas."|
|                                         |
| **3. Regi√µes Afetadas**                   |
| [ Campo de sele√ß√£o m√∫ltipla ]           |
|  [+] Cidade: Cidade X                   |
|    [+] Bairro: Centro                  |
|    [+] Bairro: Bairro Sul              |
|                                         |
| **4. Ativa√ß√£o**                           |
| ( ) Ativar Imediatamente                |
| (‚Ä¢) Agendar para: [ 21/05/2024 02:00 ]  |
|                                         |
| [ Bot√£o: Salvar Falha ] [ Cancelar ]    |
+-----------------------------------------+
```

---

### **3. A L√≥gica de Integra√ß√£o no LIA CORTEX**

Esta √© a parte mais importante. Como o LIA CORTEX intercepta o cliente e exibe a mensagem correta? O M√≥dulo de Falha Massiva se tornar√° a **primeira camada de verifica√ß√£o** no fluxo de atendimento.

**Fluxograma do Atendimento com o M√≥dulo Ativo:**

```mermaid
graph TD
    A[Cliente envia mensagem via WhatsApp] --> B{LIA CORTEX: Ponto de Entrada};
    
    subgraph "M√ìDULO DE FALHA MASSIVA (Nova Camada)"
        B --> C{1. Existe alguma Falha Massiva Ativa?};
        C --> |Sim| D{2. O cliente est√° em uma regi√£o afetada?};
        D --> |Sim| E[**A√á√ÉO:** Envia a mensagem da Falha Massiva];
        E --> F[**FIM DO FLUXO:** A conversa √© pausada. N√£o prossegue para os assistentes.];
    end

    C --> |N√£o| G[Fluxo Normal (como existe hoje)];
    D --> |N√£o| G;

    subgraph "FLUXO NORMAL"
       G --> H[Recepcionista Lia identifica a demanda];
       H --> I[Roteia para o assistente especializado (Suporte, Comercial, etc.)];
    end

    F --> End((Atendimento Resolvido pela Notifica√ß√£o));
    I --> OtherEnd((Continua Atendimento Especializado));
```

**Como a verifica√ß√£o do passo `D` funciona?**

O LIA CORTEX precisar√° de uma forma de saber a localiza√ß√£o do cliente. Isso pode ser feito de v√°rias maneiras, em ordem de prefer√™ncia:

1.  **Integra√ß√£o com CRM (Melhor Op√ß√£o):** Quando o cliente envia a mensagem, o LIA CORTEX usa o n√∫mero de telefone para consultar o CRM do ISP (ex: via API) e obter o endere√ßo de cadastro completo. Essa √© a forma mais precisa.
2.  **Solicita√ß√£o de CEP/Endere√ßo:** Se o cliente n√£o est√° no CRM (novo lead), o assistente pode ser instru√≠do a pedir o CEP como primeiro passo.
3.  **Dados da Conversa Anterior:** Se o cliente j√° informou seu endere√ßo em uma conversa anterior, essa informa√ß√£o pode ser armazenada e reutilizada.

---

### **4. Desativa√ß√£o e Notifica√ß√£o de Resolu√ß√£o**

Quando o supervisor clica em "Pausar" ou "Finalizar" na falha:

1.  Um modal de confirma√ß√£o aparece:
    > **Finalizar Falha "Instabilidade Fibra Centro"**
    >
    > ( ) Apenas desativar as notifica√ß√µes.
    > (‚Ä¢) **Desativar e enviar uma mensagem de resolu√ß√£o** para todos os clientes que foram notificados.
    >
    > **Mensagem de Resolu√ß√£o:**
    > [textarea]
    > ‚úÖ "Boa not√≠cia! A instabilidade em sua regi√£o foi corrigida. Por favor, reinicie seu modem e teste sua conex√£o. Se o problema persistir, nos chame aqui novamente."

2.  Ao confirmar, o sistema:
    *   Muda o status da falha para "Resolvida".
    *   (Se a op√ß√£o for marcada) Envia proativamente a mensagem de resolu√ß√£o para todos os clientes que receberam a notifica√ß√£o inicial.

### **5. Modelo de Dados (Backend Schema)**

Para suportar o m√≥dulo, precisar√≠amos de uma nova tabela no banco de dados.

```prisma
// schema.prisma

enum FailureStatus {
  ACTIVE
  SCHEDULED
  RESOLVED
}

model MassiveFailure {
  id              String        @id @default(cuid())
  name            String        // Nome interno
  status          FailureStatus @default(SCHEDULED)
  
  notificationMessage String    @db.Text // Mensagem para o cliente
  resolutionMessage   String?   @db.Text // Mensagem opcional de resolu√ß√£o

  // Armazena as regi√µes como um array de strings ou JSON
  affectedRegions Json

  startTime       DateTime
  endTime         DateTime?

  // Armazena quem foi notificado para poder enviar a mensagem de resolu√ß√£o
  notifiedContacts Json?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}
```